###### 本人邮箱:richsjeson@gmail.com
###### 欢迎转载，请注明出处。

---
 1. [关于组件化](#1)
 2. [源码实现方式](#2)
    * [2.1 了解RCTView](#2.1)
    * [2.2 自定义属性](#2.2)
    * [2.3 自定义方法](#2.2)
    * [2.4 事件驱动](#2.2)
    
---
<h2 id="1">1.关于组件化</h2>
######由于目前项目以产品方式发展，所以功能层次性越来越复杂，因此在架构方面也变得越来越复杂。从以往的项目来看，在早期多人协作在一个项目的运作下，大家为了完成自己手头的任务，很少人会抽出时间对一些代码组件进行封装，从而造成可重复性的代码冗余量过高，可复用性低，因此产生一些低质量的代码。从而造成代码繁乱，维护性差。如果程序中有部分代码发生异常，程序自身在修复的能力上无法进行评估，及其可能导致项目周期偏长，无法正常上线。

######组件是一种合理而又清晰自然的表现形式。从组件维护的周期上来看，生命周期长，可维护。假设一个项目中有 9大业务模块，按照架构分层的思想，首先我们会考虑到如何抽出业务层、视图层、逻辑处理层。接着我们考虑到业务的一些复用情况，我们会考虑抽出一些工具层、事件处理层和仓库层，接着我们又考虑到一些业务场景，我们还需要对这些业务场景进行分化，从而抽出场景层（这里指是opengl相关模型）。这样我们的框架也就搭建起来，在多人协作方面，基本工具层、场景层都由主程来编写。但是一旦这个项目上线时，有可能9大业务快中出现3个BUG，这时候，我们在发布的时候将面临一些问题，即使分层再好，通过关闭功能块的方式进行操作，在更新方面上也要做很大的改造，这时候将浪费人力。

######在这里，阿里想到一个很好的解决方案，利用bundle化（osgi中的插件化）的原理，将一些常用的UI层界面封装为组件，工具层封装为组件、粒度较小的业务进行抽离，本着一切皆为组件的理念，进行全方面的重构，同时降低业务颗粒的大小，通过组件更新的方式来解决线上的问题。

######因此，组件的抽离相当于对一个PC的内核引擎进行分块，而上层的视图层可以用一些基本的模型来进行操作，比如ReactNative。而组件只要负责处理好内部的行为操作。
######React Native就是利用原生组件和js之间的交互进行映射，只要在javascript语言中调用已映射好的原生组件就可以完成一个业务的操作。

 

<h2 id="2">2 源码实现方式</h3>

######一般我们在开发中，经过综合考虑上，RN在ios方面上，不管是执行效率还是性能处理方面都和原生是一样的。

<h3 id="2.1">2.3 RCTView</h3>

######RCTView是RN中的一个重要子项。在RN中RN把每一个组件划分为一个Module，而每一个Module下都有一个view和一个view的管理器。而RTCView就是一个Module的界面层，ViewManager就是一个界面层控制器。相当于MVP中的V层。如果要在RN中引用一个UI组件的话，首先要对应好ViewManager的别名。ViewManager的别名是在rn js中进行定义的。
######由于RCTView在初始化时拦截了UIView的事件，因此笔者在自定义UI控件中忽视了RCTView，而直接采用UIView，导致在实现的过程中一些原生组件的事件被RN拦截，无法执行原生的事件。（后续笔者将重点研究该模块源码）。

提供自定义好的组件给RN
>
	var RCTViewPager=requireNativeComponent('RichsViewPager', RichsViewPager);
	//将ViewPager导入module
	export default class RichsViewPager extends Component {
  	    render() {
    			return <RCTViewPager {...this.props} />;
  		}
	}
	module.exports = RichsViewPager;

实现原生组件，首先要定义一个UI组件层，即RCTView
>
#######import <React/RCTView.h>
	@interface RichsViewPager : RCTView
	@end

######上面也说过了，为了完全遵循组件化的模式，要严格按照MVC的方式进行处理。RN利用RCTViewManager来管理RCTView的操作。在RCTViewManager中注册了RCTView的事件和属性以便和javascript进行通信。
>	
	@interface RichsViewPagerManager : RCTViewManager
	@end